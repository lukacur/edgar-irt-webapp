<div class="p-3">
    <h2 class="text-lg text-purple-600">Overview of question types allowed in adaptive exercises</h2>
    <hr class="my-3">

    <div class="mt-3 p-3 shadow-md border border-slate-500/50" [formGroup]="selectedQuestionTypesForm">
        <h3 class="text-purple-600">Whitelist question types</h3>
        <hr class="mt-3">
        <app-searchable-select
            labelText="Select question types to whitelist"
            [selectableItems]="(questionTypes$ | async) ?? []"

            valueKey="idQuestionType"
            textKey="questionTypeName"

            [multi]="true"
            [searchable]="true"

            [control]="selectedQuestionTypesForm.get('questionTypeIds')!"
        ></app-searchable-select>

        <button
            type="button"
            mat-raised-button
            color="primary"
            [disabled]="!selectedQuestionTypesForm.dirty"
            (click)="allowSelectedQuestionTypes()"
        >Confirm</button>
    </div>

    <hr class="my-3">

    <div class="mt-3 p-3 shadow-md border border-slate-500/50">
        <h3 class="text-purple-600">Whitelisted question types</h3>
        <hr class="my-3">

        <div class="overflow-auto max-h-[560px]">
            <table class="w-full p-3 text-center">
                <thead>
                    <tr>
                        <th>
                            <mat-checkbox
                                color="primary"
                                [indeterminate]="removalSelectionStatus() === 'indeterminate'"
                                (change)="setRemovalSelectionToAllQuestionTypes($event.checked)"
                                [checked]="removalSelectionStatus() === 'full'"
                                [disabled]="numberOfWhitelistedQTs === 0"
                            ></mat-checkbox>
                        </th>
                        <th class="text-center">ID</th>
                        <th class="text-center">Name</th>
                        <th class="text-center">Whitelisted on</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let questionType of (whitelistedQuestionTypes$ | async) ?? []">
                        <td>
                            <mat-checkbox
                                color="primary"
                                [checked]="(this.selectedQuestionTypesForm.get('toRemoveQuestionTypeIds')?.value ?? []).includes(questionType.id_question_type)"
                                (change)="
                                    toggleQuestionTypeForRemoval(!$event.checked, questionType.id_question_type);
                                "
                            ></mat-checkbox>
                        </td>
                        <td class="text-center">{{ questionType.id_question_type }}</td>
                        <td class="text-center">{{ questionType.question_type_name }}</td>
                        <td class="text-center">{{ questionType.allowed_on | date:"dd. MM. yyyy. HH:mm:ss" }}</td>
                    </tr>
                    <tr *ngIf="numberOfWhitelistedQTs === 0">
                        <td
                            class="py-2 text-gray-500/50"
                            colspan="4"
                        >No whitelisted question types</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <hr class="my-3">

        <button
            class="mt-3"
            type="button"
            mat-flat-button
            color="warn"
            (click)="removeSelectedQuestionTypes()"
            [disabled]="(selectedQuestionTypesForm.get('toRemoveQuestionTypeIds')?.value ?? []).length === 0"
        >Remove selected question types</button>
    </div>
</div>
