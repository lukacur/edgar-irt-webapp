<div class="p-3">
    <h2 class="text-purple-600">Question statistics visualization</h2>

    <hr class="my-3">

    <form [formGroup]="questionStatisticsPlotForm">
        <h2 class="text-blue-400">Please choose a course</h2>
        <div>
            <app-searchable-select
                labelText="Course with statistics"
        
                [multi]="false"
                [searchable]="true"
                [selectableItems]="(courses$ | async) ?? []"
        
                textKey="text"
                valueKey="course"
        
                [useObjectAsValue]="false"

                [control]="questionStatisticsPlotForm.get('course')!"

                noItemsText="No courses have calculated statistics"
            >
            </app-searchable-select>
        </div>

        <div *ngIf="(questionStatisticsPlotForm.get('course')?.value ?? null) !== null">
            <label class="text-sm">Choose a calculation</label>
            <select
                class="p-3 bg-white border border-slate-500/50 rounded cursor-pointer w-full"
                formControlName="idCalculation"
            >
                <option
                    *ngFor="let calculation of courseCalculations" [ngValue]="calculation.calculationGroup"
                    [ngValue]="calculation.calculationGroup"
                    (click)="selectCalculation(calculation)"
                >
                    ({{ calculation.calculationGroup }}) Ac. years {{ calculation.acYears }}
                </option>
            </select>
        </div>
    </form>

    <div *ngIf="(questionStatisticsPlotForm.get('idCalculation')?.value ?? null) !== null">
        <hr class="my-3">
        
        <div class="flex flex-col">
            <div #questionDiffBarChart class="w-full">
                <h2 class="color-blue-400">Question difficulty bar chart</h2>
                <hr class="my-3">
                <app-bar-chart
                    [classes]="availableQuestionClasses"
                    [classColors]="questionClassesColors"

                    [data]="prepareDifficultyBarChartData()"
                    dataClassKey="qClass"
                    dataValueKey="count"

                    [chartWidth]="questionDiffBarChart.clientWidth"

                    *ngIf="courseLevelCalcs !== null && courseLevelCalcs.length !== 0"
                ></app-bar-chart>
            </div>

            <div class="w-full flex flex-col lg:flex-row justify-between items-center">
                <div #meanHistCont class="w-full lg:w-1/4">
                    <h2 class="color-blue-400">Score % mean histogram</h2>
                    <hr class="my-3">
                    <app-histogram
                        [data]="prepareMeanHistogramData()"
                        [mappingKey]="null"

                        [domainStart]="-10"
                        [domainEnd]="120"

                        [thresholdCount]="30"

                        [chartWidth]="meanHistCont.clientWidth"

                        *ngIf="courseLevelCalcs !== null && courseLevelCalcs.length !== 0"
                    ></app-histogram>
                </div>

                <div #stdDevHistCont class="w-full lg:w-1/4">
                    <h2 class="color-blue-400">Score % standard deviation histogram</h2>
                    <hr class="my-3">
                    <app-histogram
                        [data]="prepareStdDevHistogramData()"
                        [mappingKey]="null"

                        [domainStart]="-10"
                        [domainEnd]="120"

                        [thresholdCount]="30"

                        [chartWidth]="stdDevHistCont.clientWidth"

                        *ngIf="courseLevelCalcs !== null && courseLevelCalcs.length !== 0"
                    ></app-histogram>
                </div>

                <div #medianHistCont class="w-full lg:w-1/4">
                    <h2 class="color-blue-400">Score % median histogram</h2>
                    <hr class="my-3">
                    <app-histogram
                        [data]="prepareMedianHistogramData()"
                        [mappingKey]="null"

                        [domainStart]="-10"
                        [domainEnd]="120"

                        [thresholdCount]="30"

                        [chartWidth]="medianHistCont.clientWidth"

                        *ngIf="courseLevelCalcs !== null && courseLevelCalcs.length !== 0"
                    ></app-histogram>
                </div>
            </div>

            <div class="w-full flex flex-col lg:flex-row justify-between items-center">
                <div class="w-full lg:w-1/3">
                    <h2 class="color-blue-400">Question correctness scatterplot</h2>
                    <hr class="my-3">
                    <svg #questionCorrectnessScatterplot></svg>
                </div>
    
                <div class="w-full lg:w-1/3">
                    <h2 class="color-blue-400">Question incorrectness scatterplot</h2>
                    <hr class="my-3">
                    <svg #questionIncorrectnessScatterplot></svg>
                </div>
            </div>


            <div class="w-full">
                <h2 class="color-blue-400">Question acquired score scatterplot</h2>
                <hr class="my-3">
                <svg #acquiredScoreScatterplot></svg>
            </div>
        </div>
    </div>
</div>
